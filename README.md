# CCSDS MO Stub Generator
- Generates technology bindings for CCSDS MAL service specifications.
- For more information about the MO services, such as documentation, FAQs, tutorials, and open source software, please see the [CCSDS MO wiki](http://github.com/esa/CCSDS_MO/wiki).
- This generator has been modified to include the [CNES Stub Generator for MAL C API](https://github.com/CNES/ccsdsmo-malc-stubgenerator) for the [OPS-SAT](https://opssat1.esoc.esa.int/) mission.

## MAL C Support
Included a dependency to the [CNES Stub Generator for MAL C API](https://github.com/CNES/ccsdsmo-malc-stubgenerator) in the PLUGIN module's pom.xml:
```xml
<dependency>
  <groupId>fr.cnes.mo</groupId>
  <artifactId>StubGenerator_C</artifactId>
  <version>1.4.0</version>
</dependency>
```

## MO Services Specifications
The XML specification files for the ML Services are located in the `specs` folder:
- COM-nmf, Software-Management, and Platform XML files are taken from ESA's [NanoSat MO Framework (NMF) GitHub repository](https://github.com/esa/nanosat-mo-framework/tree/fd696509ced7d7dbe58b3e0692fd467ddce9d816/core/mo-services-xml/src/main/resources/xml). Read more about NMF [here](https://nanosat-mo-framework.github.io/).
- Common and Monitor-and-Control XML files are taken from the [CCSDS GitHub repository](https://github.com/ccsdsmo/xml-service-specifications/tree/584d493e62360a8fee0bc2d18ae507e447383b68/xml-ccsds-mo-standards/src/main/resources/xml).

**Note:** If using zproject, the "Platform" area name in `area105-v002-Platform.xml` should be renamed, e.g. to "PL", in order to avoid a conflict with code generated by zproject/gsl such as in the [CCSDS MO MAL C SEPP Apps](https://github.com/georgeslabreche/ccsdsmo-malc-sepp-apps) project.

## Building
Two projects need to be built and installed:
- MAL C Plugin for the CCSDS MO SubGenerator
- CCSDS MO StubGenerator

### MAL C Plugin for the CCSDS MO SubGenerator
Build and install the [CNES Stub Generator for MAL C API](https://github.com/CNES/ccsdsmo-malc-stubgenerator) project so that its jar artifact is deployed to the local maven repo:

```bash
git clone https://github.com/CNES/ccsdsmo-malc-stubgenerator.git
cd ccsdsmo-malc-stubgenerator
mvn clean install
```
### CCSDS MO StubGenerator
```bash
git clone https://github.com/georgeslabreche/CCSDS_MO_StubGenerator.git
cd CCSDS_MO_StubGenerator
mvn clean install
cd PLUGIN && mvn install -Passemble && cd ..
```

## Running
### Known Issue
Schema validation triggers the following exceptions:
- **COMSchema.xsd** - java.lang.IllegalStateException: too many : delimiters in key XML:http://www.ccsds.org/schema/COMSchema:CommentType
- **ServiceSchema.xsd** - java.lang.IllegalStateException: too many : delimiters in key XML:http://www.ccsds.org/schema/ServiceSchema:AnyTypeReference

**Workaround:** Remove the XSD files from the `specs/xsd-ref/` folder before generating the stubs.

### Generate Stubs
Run the following bash script:
```bash
./generated_stubs.sh
```

Prior to generating the stubs the script includes commands to:
- Move the XSD files out of the `specs/xsd-ref/`
- Rename the area name in `area105-v002-Platform.xml` from "Platform" to "PL".

**Important:** When building the stubs with zproject/gsl the class elements in the generated `project.xml` file must be listed in the correct dependency order. Manual re-orderding is likely necessary so that these elements are listed in such way that the *platform* classes preceed the *softwaremanagement* classes, i.e.: com, common, mc, pf, and softwaremanagement.